<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>rise-data-rss test</title>

    <script src="../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
    <script src="../node_modules/@polymer/test-fixture/test-fixture.js"></script>
    <script src="../node_modules/mocha/mocha.js"></script>
    <script src="../node_modules/chai/chai.js"></script>
    <script src="../node_modules/wct-mocha/wct-mocha.js"></script>
    <script src="../node_modules/sinon/pkg/sinon.js"></script>

    <script type="text/javascript">
      RisePlayerConfiguration = {
        isConfigured: () => true
      };
    </script>

    <script type="module" src="../src/rise-data-rss-config.js"></script>
    <script type="module" src="../src/rise-data-rss.js"></script>
  </head>
  <body>
    <test-fixture id="test-block">
      <template>
        <rise-data-rss></rise-data-rss>
      </template>
    </test-fixture>

    <script type="module">
      suite('rise-data-rss', () => {
        let sandbox = sinon.createSandbox();
        let element;
        let logger;

        setup(() => {
          element = fixture("test-block");

          // RiseDataRss => RiseElement => LoggerMixin
          logger = element.__proto__.__proto__.__proto__;

          sandbox.stub(logger, "initLogger");
          sandbox.stub(logger, "log");
          sandbox.stub(window, "fetch");
        });

        teardown(()=>{
          sandbox.restore();
        });

        suite( "Properties", () => {
          test("should not set feedUrl", () => {
            assert.notOk(element.feedUrl);
          });

          test("should set maxItems", () => {
            assert.equal(element.maxItems, 25);
          });
        });

        suite("ready", () => {
          let stub;

          setup(() => {
            stub = sandbox.stub(window, "addEventListener");
          });

          test("should listen for rise-components-ready and call init", () => {
            RisePlayerConfiguration.isConfigured = () => false;
            element.ready();

            assert.isTrue(stub.calledWith('rise-components-ready'));
          });

          test("should call _init() if  RisePlayerConfiguration is configured", () => {
            RisePlayerConfiguration.isConfigured = () => true;
            sandbox.stub(element, '_init');

            element.ready();

            assert.isTrue(element._init.calledOnce);
            assert.isFalse(stub.calledOnce);
          });
        });
      });
    </script>

  </body>
</html>
