<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>feed-formatter test</title>

    <script src="../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
    <script src="../node_modules/@polymer/test-fixture/test-fixture.js"></script>
    <script src="../node_modules/mocha/mocha.js"></script>
    <script src="../node_modules/chai/chai.js"></script>
    <script src="../node_modules/wct-mocha/wct-mocha.js"></script>
    <script src="../node_modules/sinon/pkg/sinon.js"></script>
  </head>
  <body>
    <script type="module">
      import FeedFormatter from "../src/feed-formatter.js";

      suite("feed-formatter", () => {
        let sandbox = sinon.createSandbox();
        let formatter = new FeedFormatter();

        setup(() => {
          
        });

        teardown(()=>{
          sandbox.restore();
        });

        suite("basics", () => {
          test("should handle an empty feed", () => {
            assert.isTrue(formatter.formatFeed({}) != null);
          });
        });

        suite("title", () => {
          test("should return the correct title", () => {
            assert.equal(formatter.formatFeed({}).title, null);
            assert.equal(formatter.formatFeed(nprSample).title, "In Book, Former Defense Chief Mattis Sideswipes President Trump's Leadership Skills");
            assert.equal(formatter.formatFeed(wiredSample).title, "Fitbit Premium, Versa 2, Aria Air: Pricing, Specs, Details");
            assert.equal(formatter.formatFeed(espnSample).title, "Kobe: 'Nothin but love' for Shaq after drama");
          });
        });

        suite("description", () => {
          test("should return the correct description", () => {
            assert.equal(formatter.formatFeed({}).description, null);
            assert.equal(formatter.formatFeed(nprSample).description, "In the general's upcoming leadership book,<em> Call Sign Chaos,</em> the Obama administration catches the most flak. Mattis barely mentions President Trump but implies criticism of the sitting president.");
            assert.equal(formatter.formatFeed(wiredSample).description, "The company’s new offerings include two fitness-tracking products, a subscription service for personalized health advice, and lots and lots of partnerships.");
            assert.equal(formatter.formatFeed(espnSample).description, "Kobe Bryant and Shaquille O'Neal, who won three titles together with the Lakers, were trending after a quote from Bryant on July 29 surfaced, saying he could have had \"12 rings\" if O'Neal spent more time in the gym.");
          });
        });

        suite("link", () => {
          test("should return the correct link", () => {
            assert.equal(formatter.formatFeed({}).link, null);
            assert.equal(formatter.formatFeed(nprSample).link, "https://www.npr.org/2019/08/28/755018189/in-book-former-defense-chief-mattis-side-swipes-president-trump-s-leadership-ski?utm_medium=RSS&utm_campaign=news");
            assert.equal(formatter.formatFeed(wiredSample).link, "https://www.wired.com/story/fitbit-versa-2-aria-air-smart-scale-fitbit-premium");
            assert.equal(formatter.formatFeed(espnSample).link, "http://www.espn.com/nba/story/_/id/27485035/kobe-nothin-love-shaq-drama");
          });
        });

        suite("imageUrl", () => {
          test("should return the correct imageUrl", () => {
            assert.equal(formatter.formatFeed({}).imageUrl, null);
            assert.equal(formatter.formatFeed(nprSample).imageUrl, "https://media.npr.org/assets/img/2019/08/28/gettyimages-1074493698_wide-d77a974046aaf94c8bd37c8083750e56ee67606a.jpg?s=600");
            assert.equal(formatter.formatFeed(wiredSample).imageUrl, "https://media.wired.com/photos/5d65a6d443e62000086148e5/master/pass/Gear-Fitbit_Versa_2-Lead.jpg");
            assert.equal(formatter.formatFeed(espnSample).imageUrl, "https://a.espncdn.com/photo/2016/1101/r147434_600x400_3-2.jpg");
          });
        });

        suite("author", () => {
          test("should return the correct author", () => {
            assert.equal(formatter.formatFeed({}).author, null);
            assert.equal(formatter.formatFeed(nprSample).author, "David Welna");
            assert.equal(formatter.formatFeed(wiredSample).author, "Adrienne So");
            assert.equal(formatter.formatFeed(espnSample).author, null);
          });
        });

        suite("pubDate", () => {
          test("should return the correct pubDate", () => {
            assert.equal(formatter.formatFeed({}).pubDate, null);
            assert.equal(formatter.formatFeed(nprSample).pubDate, "2019-08-28T17:52:00.000Z");
            assert.equal(formatter.formatFeed(wiredSample).pubDate, "2019-08-28T13:00:00.000Z");
            assert.equal(formatter.formatFeed(espnSample).pubDate, "2019-08-28T19:27:14.000Z");
          });
        });

        suite("_isValidImage", () => {
          test("should return true for valid images", () => {
            assert.isTrue(formatter._isValidImage("https://a.espncdn.com/photo/2016/1101/r147434_600x400_3-2.jpg"));
            assert.isTrue(formatter._isValidImage("https://a.espncdn.com/photo/2016/1101/r147434_600x400_3-2.png"));
            assert.isTrue(formatter._isValidImage("https://a.espncdn.com/photo/2016/1101/r147434_600x400_3-2.jpg?test=1"));
          });

          test("should return false for non valid images", () => {
            assert.isFalse(formatter._isValidImage("https://a.espncdn.com/photo/2016/1101/r147434_600x400_3-2.gif"));
            assert.isFalse(formatter._isValidImage("https://a.espncdn.com/photo/2016/1101/r147434_600x400_3-2.pdf"));
            assert.isFalse(formatter._isValidImage("https://a.espncdn.com/photo/2016/1101/r147434_600x400_3-2.gif?test=1"));
          });
        });
      });

      let nprSample = {
        "title": "In Book, Former Defense Chief Mattis Sideswipes President Trump's Leadership Skills",
        "description": "<img src='https://media.npr.org/assets/img/2019/08/28/gettyimages-1074493698_wide-d77a974046aaf94c8bd37c8083750e56ee67606a.jpg?s=600' alt='James Mattis, then U.S. secretary of defense, leaves a news conference following a meeting about U.S.-China diplomacy and security at the State Department in Washington, D.C., in June 2017. Mattis' new book, Call Sign Chaos, implies criticism of President Trump without taking direct shots at him.'/><p>In the general's upcoming leadership book,<em> Call Sign Chaos,</em> the Obama administration catches the most flak. Mattis barely mentions President Trump but implies criticism of the sitting president.</p><p>(Image credit: Bloomberg via Getty Images)</p><img src='https://media.npr.org/include/images/tracking/npr-rss-pixel.png?story=755018189' />",
        "summary": "In the general's upcoming leadership book,<em> Call Sign Chaos,</em> the Obama administration catches the most flak. Mattis barely mentions President Trump but implies criticism of the sitting president.",
        "pubdate": "2019-08-28T17:52:00.000Z",
        "pubDate": "2019-08-28T17:52:00.000Z",
        "link": "https://www.npr.org/2019/08/28/755018189/in-book-former-defense-chief-mattis-side-swipes-president-trump-s-leadership-ski?utm_medium=RSS&utm_campaign=news",
        "author": "David Welna",
        "image": {},
        "enclosures": [],
        "rss:title": {
          "@": {},
          "#": "In Book, Former Defense Chief Mattis Sideswipes President Trump's Leadership Skills"
        },
        "rss:description": {
          "@": {},
          "#": "In the general's upcoming leadership book,<em> Call Sign Chaos,</em> the Obama administration catches the most flak. Mattis barely mentions President Trump but implies criticism of the sitting president."
        },
        "rss:pubdate": {
          "@": {},
          "#": "Wed, 28 Aug 2019 13:52:00 -0400"
        },
        "rss:link": {
          "@": {},
          "#": "https://www.npr.org/2019/08/28/755018189/in-book-former-defense-chief-mattis-side-swipes-president-trump-s-leadership-ski?utm_medium=RSS&utm_campaign=news"
        },
        "permalink": "https://www.npr.org/2019/08/28/755018189/in-book-former-defense-chief-mattis-side-swipes-president-trump-s-leadership-ski?utm_medium=RSS&utm_campaign=news",
        "content:encoded": {
          "@": {},
          "#": "<img src='https://media.npr.org/assets/img/2019/08/28/gettyimages-1074493698_wide-d77a974046aaf94c8bd37c8083750e56ee67606a.jpg?s=600' alt='James Mattis, then U.S. secretary of defense, leaves a news conference following a meeting about U.S.-China diplomacy and security at the State Department in Washington, D.C., in June 2017. Mattis' new book, Call Sign Chaos, implies criticism of President Trump without taking direct shots at him.'/><p>In the general's upcoming leadership book,<em> Call Sign Chaos,</em> the Obama administration catches the most flak. Mattis barely mentions President Trump but implies criticism of the sitting president.</p><p>(Image credit: Bloomberg via Getty Images)</p><img src='https://media.npr.org/include/images/tracking/npr-rss-pixel.png?story=755018189' />"
        },
        "dc:creator": {
          "@": {},
          "#": "David Welna"
        }
      };

      let wiredSample = {
        "title": "Fitbit Premium, Versa 2, Aria Air: Pricing, Specs, Details",
        "description": "The company’s new offerings include two fitness-tracking products, a subscription service for personalized health advice, and lots and lots of partnerships.",
        "summary": "The company’s new offerings include two fitness-tracking products, a subscription service for personalized health advice, and lots and lots of partnerships.",
        "date": "2019-08-28T13:00:00.000Z",
        "pubdate": "2019-08-28T13:00:00.000Z",
        "pubDate": "2019-08-28T13:00:00.000Z",
        "link": "https://www.wired.com/story/fitbit-versa-2-aria-air-smart-scale-fitbit-premium",
        "author": "Adrienne So",
        "image": {
          "url": "https://media.wired.com/photos/5d65a6d443e62000086148e5/master/pass/Gear-Fitbit_Versa_2-Lead.jpg"
        },
        "enclosures": [
          {
            "url": null,
            "type": null,
            "length": null
          }
        ],
        "media:content": {
          "@": {}
        },
        "rss:description": {
          "@": {},
          "#": "The company’s new offerings include two fitness-tracking products, a subscription service for personalized health advice, and lots and lots of partnerships."
        },
        "dc:creator": {
          "@": {},
          "#": "Adrienne So"
        },
        "media:thumbnail": {
          "@": {
            "url": "https://media.wired.com/photos/5d65a6d443e62000086148e5/master/pass/Gear-Fitbit_Versa_2-Lead.jpg",
            "width": "2400",
            "height": "1800"
          }
        }
      };

      let espnSample = {
        "title": "Kobe: 'Nothin but love' for Shaq after drama",
        "description": "Kobe Bryant and Shaquille O'Neal, who won three titles together with the Lakers, were trending after a quote from Bryant on July 29 surfaced, saying he could have had \"12 rings\" if O'Neal spent more time in the gym.",
        "summary": "Kobe Bryant and Shaquille O'Neal, who won three titles together with the Lakers, were trending after a quote from Bryant on July 29 surfaced, saying he could have had \"12 rings\" if O'Neal spent more time in the gym.",
        "date": "2019-08-28T19:27:14.000Z",
        "pubdate": "2019-08-28T19:27:14.000Z",
        "pubDate": "2019-08-28T19:27:14.000Z",
        "link": "http://www.espn.com/nba/story/_/id/27485035/kobe-nothin-love-shaq-drama",
        "guid": "27485035",
        "author": null,
        "image": {},
        "source": {},
        "categories": [],
        "enclosures": [],
        "rss:@": {},
        "rss:title": {
          "@": {},
          "#": "Kobe: 'Nothin but love' for Shaq after drama"
        },
        "rss:description": {
          "@": {},
          "#": "Kobe Bryant and Shaquille O'Neal, who won three titles together with the Lakers, were trending after a quote from Bryant on July 29 surfaced, saying he could have had \"12 rings\" if O'Neal spent more time in the gym."
        },
        "rss:image": {
          "@": {},
          "#": "https://a.espncdn.com/photo/2016/1101/r147434_600x400_3-2.jpg"
        },
        "rss:link": {
          "@": {},
          "#": "http://www.espn.com/nba/story/_/id/27485035/kobe-nothin-love-shaq-drama"
        },
        "rss:pubdate": {
          "@": {},
          "#": "Wed, 28 Aug 2019 14:27:14 EST"
        }
      };
    </script>
  </body>
</html>
